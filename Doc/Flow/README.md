# 操作流程

## 开机
0.发送CMD_ASK给下位机检测下位机是否就绪
1.若是冷启动的话首先输入密码(热启动没有断点,所以RTC能够保存复位前的时间)
2.进入欢迎界面

## 选择功能
1.按键"下+0"输入管理员密码进入模式选择
2.根据说明操作
**note** 删除用户数据**不会**清空管理员密码

## 指纹功能
选择模式
  1) 登陆
    - 按下指纹
    - 返回结果(匹配房间ID:xxxx或无匹配用户回到登陆)
    - 若匹配成功发送房间ID到下位机
  2) 注册
    - 输入房间ID
    - 按下指纹x5
    - 若该房间ID未保存指纹数据则保存到flash即可
    - 若该房间ID已有指纹数据则需要管理员输入密码后保存
    - 回到注册

## RFID
选择模式
  1) 登陆
    - 刷卡
    - 返回结果(匹配房间ID:xxxx或无匹配用户回到登陆)
    - 若匹配成功发送房间ID到下位机
  2) 注册
    - 输入房间ID
    - 刷卡
    - 若该房间ID未保存RFID数据则保存到flash即可
    - 若该房间ID已有RFID数据则需要管理员输入密码后保存
    - 回到注册
## 手动
选择模式
  1) 登陆
    - 输入房间ID
    - 输入密码
    - 返回结果(匹配房间ID:xxxx或无匹配用户回到登陆)
    - 若匹配成功发送房间ID到下位机
    - 进入操作界面
    - 响应 上下左右 按键操作并发送指令到下位机
    - 响应 确定 按键回到登陆
  2) 注册
    - 输入房间ID
    - 输入房间ID
    - 输入密码
    - 若该房间ID未保存密码数据则保存到flash即可
    - 若该房间ID已有密码数据则需要管理员输入密码后保存
    - 回到注册

## 下位机错误消息响应
消息完整性在STP_Server层面已完成,这里说回调函数的操作
1.清屏
2.显示相应错误信息
3.蜂鸣器报警
4.等待用户按下取消键软件复位

## 通讯协议
0xEF(1Byte) | 0xFE(1Byte) | CMD(1Byte) | size(1Byte) | data(? Bytes) | sum(1Byte)
---- | :----- | :------ | :------- | :--------- | :------- |
固定开头0 | 固定开头1 | 指令ID | 指定data大小(没有则为0) | 有效数据 | sum(1Byte) = CMD + size + data

从机/主机在接收到CMD!=CMD_Ack的消息后会向对方回应一个CMD_Ack消息作为响应